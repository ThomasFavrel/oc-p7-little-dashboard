import pandas as pd
import numpy as np

def feat_ext_source(df):
    x1 = df['EXT_SOURCE_1'].fillna(-1) + 1e-1
    x2 = df['EXT_SOURCE_2'].fillna(-1) + 1e-1
    x3 = df['EXT_SOURCE_3'].fillna(-1) + 1e-1
    
    df['EXT_SOURCE_1over2_NAminus1_Add0.1'] = x1/x2
    df['EXT_SOURCE_2over1_NAminus1_Add0.1'] = x2/x1
    df['EXT_SOURCE_1over3_NAminus1_Add0.1'] = x1/x3
    df['EXT_SOURCE_3over1_NAminus1_Add0.1'] = x3/x1
    df['EXT_SOURCE_2over3_NAminus1_Add0.1'] = x2/x3
    df['EXT_SOURCE_3over2_NAminus1_Add0.1'] = x3/x2
    
    df['EXT_SOURCE_na1_2'] = (df['EXT_SOURCE_1'].isnull()) * (df['EXT_SOURCE_2'].fillna(0))
    df['EXT_SOURCE_na1_3'] = (df['EXT_SOURCE_1'].isnull()) * (df['EXT_SOURCE_3'].fillna(0))
    df['EXT_SOURCE_na2_1'] = (df['EXT_SOURCE_2'].isnull()) * (df['EXT_SOURCE_1'].fillna(0))
    df['EXT_SOURCE_na2_3'] = (df['EXT_SOURCE_2'].isnull()) * (df['EXT_SOURCE_3'].fillna(0))
    df['EXT_SOURCE_na3_1'] = (df['EXT_SOURCE_3'].isnull()) * (df['EXT_SOURCE_1'].fillna(0))
    df['EXT_SOURCE_na3_2'] = (df['EXT_SOURCE_3'].isnull()) * (df['EXT_SOURCE_2'].fillna(0))
    
    df['CREDIT_LENGTH'] = df['AMT_CREDIT'] / df['AMT_ANNUITY']
    
    return df


def learning_rate_010_decay_power_099(current_iter):
    base_learning_rate = 0.1
    lr = base_learning_rate  * np.power(.99, current_iter)
    return lr if lr > 1e-3 else 1e-3

def learning_rate_010_decay_power_0995(current_iter):
    base_learning_rate = 0.1
    lr = base_learning_rate  * np.power(.995, current_iter)
    return lr if lr > 1e-3 else 1e-3

def learning_rate_005_decay_power_099(current_iter):
    base_learning_rate = 0.05
    lr = base_learning_rate  * np.power(.99, current_iter)
    return lr if lr > 1e-3 else 1e-3

mean_zero = [0.09474652022193902,
 0.6661436497822143,
 0.34313575838039895,
 0.30558858923886845,
 0.41305790932875164,
 168892.14,
 603141.25,
 27177.902,
 543020.2,
 0.278204750460598,
 1.0974657347026435,
 0.35486103962030396,
 1.250029286578937,
 0.2692661315801618,
 0.020999512,
 -16139.44283082297,
 -2438.3664981697752,
 -5029.974,
 -3017.5402788082315,
 11.936331,
 0.999996450111644,
 0.8145893311655349,
 0.19665316525795265,
 0.9981469582781621,
 0.2848039929144228,
 0.05690116045850358,
 2.2592163976442943,
 2.1504843,
 2.0442316089158994,
 2.0230778242024288,
 2.9601986517524024,
 12.084103954930617,
 0.014945029978807166,
 0.050280618674542685,
 0.04042612859825558,
 0.07468965101047573,
 0.22424999733758375,
 0.1759821653608994,
 9.529764038920977,
 0.5113013,
 0.52335984,
 0.5209073,
 0.11824441,
 0.08891676,
 0.9778761,
 0.75314176,
 0.04496135,
 0.080055706,
 0.15022102,
 0.22784737,
 0.23312385,
 0.066554256,
 0.101324156,
 0.10831053,
 0.00883662,
 0.028573,
 0.11498108,
 0.08797215,
 0.9772016,
 0.7602813,
 0.042855542,
 0.07553009,
 0.14565392,
 0.22384642,
 0.22925305,
 0.06517266,
 0.10619713,
 0.10684426,
 0.0080830725,
 0.027230065,
 0.11865099,
 0.08841182,
 0.9779002,
 0.75640637,
 0.04494154,
 0.07917965,
 0.14970663,
 0.22746044,
 0.2328504,
 0.067399696,
 0.102504455,
 0.10952726,
 0.008673894,
 0.028449323,
 -0.5258272127341596,
 -0.4827990159709477,
 0.10341307,
 0.11783144420107988,
 -0.46082165715888235,
 1.4145063,
 0.13902783,
 1.3977011,
 0.09660311,
 -977.0937,
 3.194899520410083e-05,
 0.7064597318414336,
 8.874720890028009e-05,
 0.015133174061675761,
 0.09077419515156249,
 0.0001952438595806162,
 0.08230061164576374,
 0.003968775182020525,
 2.4849218492078426e-05,
 0.004004274065580638,
 7.099776712022407e-06,
 0.0037415823272358086,
 0.0030990525347977804,
 0.0012779598081640333,
 0.010301776009144512,
 0.0002839910684808963,
 0.008370636743474418,
 0.0006070309088779158,
 0.0005076340349096021,
 0.0003123901753289859,
 0.0063686976,
 0.0069328058,
 0.034365624,
 0.27073506,
 0.26504493,
 1.8903096,
 -0.49905357,
 0.13522048,
 -0.25019524,
 0.061264917,
 0.79573107,
 0.5766702,
 0.28829938,
 0.23702632,
 0.00037195935,
 0.0007846563,
 0.03826703,
 0.09897156,
 21.692629]

mean_un = [0.06325641439406164,
 0.5707197030821365,
 0.3051073099887042,
 0.3160803614652251,
 0.4639341616911409,
 160929.61,
 558205.44,
 26501.066,
 489301.2,
 0.27283362917540743,
 0.84407777957076,
 0.2823140229143134,
 1.2105050831047282,
 0.3250766499919316,
 0.019131005,
 -14884.946385347748,
 -1815.5348773217152,
 -4486.662,
 -2732.6662497982893,
 13.659394,
 1.0,
 0.8796191705664032,
 0.23817976440213007,
 0.998184605454252,
 0.24523963208003874,
 0.055349362594803934,
 2.522672260771341,
 2.1814184,
 2.1537437469743423,
 2.134944327900597,
 2.987050185573665,
 11.796958205583346,
 0.017427787639180247,
 0.05591415200903663,
 0.042520574471518476,
 0.11840406648378247,
 0.30304986283685653,
 0.22180087138938195,
 9.714216556398258,
 0.38689736,
 0.41090477,
 0.3906585,
 0.10558816,
 0.08145787,
 0.9755994,
 0.74316406,
 0.039374482,
 0.061918873,
 0.14258672,
 0.20295794,
 0.211884,
 0.06308313,
 0.092068784,
 0.0939497,
 0.008182123,
 0.02481592,
 0.103281036,
 0.0812602,
 0.9748926,
 0.75061244,
 0.03801544,
 0.0587627,
 0.13864723,
 0.19954495,
 0.20861278,
 0.061891794,
 0.09701488,
 0.093307726,
 0.0077405493,
 0.023659531,
 0.10603109,
 0.08119336,
 0.9755356,
 0.7464599,
 0.03933376,
 0.061234854,
 0.1421084,
 0.20263053,
 0.21167678,
 0.063767284,
 0.09328981,
 0.095058,
 0.008100185,
 0.024722027,
 -0.6013796998547685,
 -0.5525254155236404,
 0.08959592,
 -0.05930288849443279,
 -0.5348959173793771,
 1.4962078,
 0.19198807,
 1.4777311,
 0.13825238,
 -808.6181,
 0.00016136840406648378,
 0.7790059706309505,
 0.0,
 0.015007261578182992,
 0.06079554623204776,
 0.00012102630304986284,
 0.07406809746651606,
 0.00298531547522995,
 0.0,
 0.003025657576246571,
 0.0,
 0.0012102630304986284,
 0.0012102630304986284,
 0.0004437631111828304,
 0.006051315152493142,
 8.068420203324189e-05,
 0.005728578344360174,
 0.00048410521219945134,
 0.0005244473132160723,
 0.0005647894142326933,
 0.006632852,
 0.00804721,
 0.034920014,
 0.22790675,
 0.2600956,
 2.029214,
 -0.97876996,
 0.19560653,
 -0.50417763,
 0.0741241,
 0.88455015,
 0.3763917,
 0.2359988,
 0.17966743,
 0.0003420559,
 0.0007027698,
 0.030035162,
 0.08803471,
 20.765898]

mean_data = [0.09219966915399348,
 0.6584259691275649,
 0.3400601004284032,
 0.30643714089015195,
 0.4171726696401479,
 168248.16,
 599506.94,
 27123.158,
 538675.2,
 0.27777034588742755,
 1.0769722696231814,
 0.34899359516064304,
 1.2468326552186553,
 0.2737799645661969,
 0.02084839,
 -16037.981894827513,
 -2384.320918479018,
 -4986.0317,
 -2994.50028875613,
 12.061371,
 0.9999967372188706,
 0.8198488027224645,
 0.20001174601206576,
 0.9981500030996421,
 0.28160411371444793,
 0.056775654432325025,
 2.2805241331606236,
 2.1529863,
 2.0530887117561267,
 2.032125342999866,
 2.9623703452348713,
 12.060880233093084,
 0.015145830002577597,
 0.05073624656184438,
 0.040595522811734265,
 0.07822517757686297,
 0.2306231585679001,
 0.1796878823571636,
 9.54468215617628,
 0.5019565,
 0.51426435,
 0.51077545,
 0.11736159,
 0.08840177,
 0.9777167,
 0.7524548,
 0.04457425,
 0.07880138,
 0.1496891,
 0.22610976,
 0.23165546,
 0.06631139,
 0.10068508,
 0.107303634,
 0.008791269,
 0.028313546,
 0.11416496,
 0.08750873,
 0.97703964,
 0.7596156,
 0.04252019,
 0.07437046,
 0.14516574,
 0.22214991,
 0.2278261,
 0.064943105,
 0.10556313,
 0.10589517,
 0.008059339,
 0.026983488,
 0.117770724,
 0.087913446,
 0.9777344,
 0.75572175,
 0.044552997,
 0.07793858,
 0.14917721,
 0.22572699,
 0.23138662,
 0.06714552,
 0.10186823,
 0.10851277,
 0.00863414,
 0.028191919,
 -0.531937733084927,
 -0.4884383350680453,
 0.102445066,
 0.10350520576729193,
 -0.4668126217425209,
 1.4211141,
 0.14331114,
 1.4041737,
 0.099971615,
 -963.46765,
 4.2416154681927784e-05,
 0.7123271133849071,
 8.156952823447651e-05,
 0.015122990534671943,
 0.08834958742132619,
 0.00018924130550398549,
 0.08163478385706409,
 0.0038892351062198398,
 2.283946790565342e-05,
 0.0039251256986430096,
 6.52556225875812e-06,
 0.0035368547442469014,
 0.002946291359829291,
 0.0012104917989996314,
 0.009958008006864891,
 0.00026754805260908294,
 0.00815695282344765,
 0.000597088946676368,
 0.0005089938561831334,
 0.00033280367519666416,
 0.0063891257,
 0.007018986,
 0.0344085,
 0.267423,
 0.26466218,
 1.9010515,
 -0.5378521,
 0.1401044,
 -0.27073678,
 0.062304933,
 0.80291456,
 0.5604722,
 0.2840694,
 0.2323873,
 0.00036954082,
 0.0007780335,
 0.03760126,
 0.098087,
 21.617676]